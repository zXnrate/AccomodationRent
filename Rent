/*
 * Copyright (c) 2007-2018 OmertaBeyond Dev Team
 *
 * OmertaBeyond is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * OmertaBeyond is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with OmertaBeyond.  If not, see <http://www.gnu.org/licenses/>.
 *
 */

// ==UserScript==
// @name                     Omerta Beyond
// @id                       Omerta Beyond
// @version                  2.2.8
// @date                     04-04-2020
// @description              Omerta Beyond 2.2 (We're back to reclaim the throne ;))
// @homepageURL              https://www.omertabeyond.net/
// @namespace                v4.omertabeyond.com
// @updateURL                https://raw.githubusercontent.com/OmertaBeyond/OBv2/master/ob.meta.js
// @supportURL               https://github.com/OmertaBeyond/OBv2/issues
// @icon                     https://raw.githubusercontent.com/OmertaBeyond/OBv2/master/images/logo.small.png
// @screenshot               https://raw.githubusercontent.com/OmertaBeyond/OBv2/master/images/logo.small.png
// @author                   OBDev Team <info@omertabeyond.com>
// @author                   vBm <vbm@omertabeyond.com>
// @author                   Dopedog <dopedog@omertabeyond.com>
// @author                   Rix <rix@omertabeyond.com>
// @author                   MrWhite <mrwhite@omertabeyond.com>
// @author                   MurderInc <murderinc@omertabeyond.com>
// @author                   Sebbe <sebbe@omertabeyond.com>
// @author                   Brainscrewer <brainscrewer@omertabeyond.com>
// @author                   semitom <tom.gankema@gmail.com>
// @license                  GPL-3.0-or-later
// @contributionURL          https://www.patreon.com/bePatron?u=7718354
// @contributionAmount       $1.00
// @encoding                 UTF-8
// @priority                 1
// @require                  https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js
// @require                  https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js
// @require                  https://cdnjs.cloudflare.com/ajax/libs/howler/2.0.7/howler.min.js
// @include                  http://*.barafranca.com/*
// @include                  https://*.barafranca.com/*
// @include                  http://barafranca.com/*
// @include                  https://barafranca.com/*
// @include                  http://*.barafranca.nl/*
// @include                  https://*.barafranca.nl/*
// @include                  http://barafranca.nl/*
// @include                  https://barafranca.nl/*
// @include                  http://*.barafranca.us/*
// @include                  https://*.barafranca.us/*
// @include                  http://barafranca.us/*
// @include                  https://barafranca.us/*
// @include                  http://*.barafranca.gen.tr/*
// @include                  https://*.barafranca.gen.tr/*
// @include                  http://barafranca.gen.tr/*
// @include                  https://barafranca.gen.tr/*
// @include                  http://omerta.com.tr/*
// @include                  https://omerta.com.tr/*
// @include                  http://*.omerta.com.tr/*
// @include                  https://*.omerta.com.tr/*
// @include                  http://*.omerta.dm/*
// @include                  https://*.omerta.dm/*
// @include                  http://omerta.dm/*
// @include                  https://omerta.dm/*
// @include                  http://*.omerta.pt/*
// @include                  https://*.omerta.pt/*
// @include                  http://omerta.pt/*
// @include                  https://omerta.pt/*
// @include                  https://*.omerta.land*
// @exclude                  http://*/game-register.php*
// @exclude                  https://*/game-register.php*
// @grant                    GM_xmlhttpRequest
// @grant                    GM.xmlHttpRequest
// @grant                    unsafeWindow
// @connect                  gm.omertabeyond.net
// @connect                  self
// ==/UserScript==
// ==OpenUserJS==
// @author                   vBm
// @collaborator             Gwildor
// @collaborator             MurderInc
// @collaborator             Sebbe
// @collaborator             Brainscrewer
// @collaborator             Ivdbroek85
// ==/OpenUserJS==

/*
 * Define constants for our website
 */


var ask = Number(prompt('1-Villa 2-House 3-Apartment | House is default'))
var search = null
switch(ask){
	case 1:
		search = 'villa'
	break;

	case 2:
		search = 'house'
	break;

	case 3:
		search = 'apartment'
	break;

	default:
		search = 'house'
	break;
}

//console.log('Searching for '+search)
//console.log('Start')
var r = null
var last = null
var city_spots = omerta.modules.City.spots()
for(var spot of city_spots){
	var accomodation = spot.getAccomodations()
	for(var acco of accomodation){

		if(search == 'villa'){
			if(acco.name.toLowerCase() == search && acco.can_rent_villa && acco.owner_name == 'Local Mob'){ 
				r = acco
			}
			last = acco
		}else{
			if(acco.name.toLowerCase() == search && acco.can_rent && acco.owner_name == 'Local Mob'){ 
				r = acco
			}
		}
		////console.log(i, accomodation[j].name, accomodation[j].can_rent, accomodation[j].owner_name )
		////console.log(accomodation[j])
    }
}
if(r){
	//console.log(r)
	var url = $(r.getActionLink() ).attr('href')
	//console.log('Redirect to '+ $(r.getActionLink()).text().toLowerCase().trim() + ' the ' +search)
	window.omerta.GUI.container.loadPage(url)
}else{
	if(last){
		if(!last.can_rent_villa){
			alert('You already have one '+search)
		}else{
			alert('Nothing here -  '+search)
		}
	}else{
		alert('Nothing here -  '+search)
	}
	
}
//console.log('End')
